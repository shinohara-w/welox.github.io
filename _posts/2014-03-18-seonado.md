---
layout: post
title: 開発環境と検索インデックス化についてちょっと
date: 2014-03-18
category : shinohara-w
tags : [SEO, googleMapsAPI, ]
---

技術者ではない私がここで書ける事を書いていきます。<br />
専門用語に拘らずざっくりと。<br />
<br />

### 開発環境の作成と検索インデックス化について
今回のお話は、開発環境を構築する際に気をつけてもらいたいことです。<br />
<br />
<br />
### インデックス化の仕組みについて
検索BOTがサイトに訪れてくれることは、サービスにおいて非常に重要です。<br />
<br />
・Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)<br />
・Mozilla/5.0 (compatible; Yahoo! Slurp/3.0; http://help.yahoo.com/help/us/ysearch/slurp)<br />
<br />
上記のようなユーザーエージェントを持つものが、クローラーと呼ばれる巡回ロボットです。<br />
これらがサイト上に訪れると、ドメイン下にあるクローリング可能なページを解析し、googleやYahooの検索結果に反映されます。<br />
<br />
<br />
### 開発環境の構築
ただし、それは通常のサービスに於いてのことで、開発環境などについては逆にこの検索BOTにクロールされることを避けなければなりません。<br />
<br />
先述のBOTがクローリングされた時、開発環境で本番で使用するデザインが反映済みとしましょう。<br />
すると、この開発環境のドメインでこのデザインで評価が行われます。<br />
<br />
つまり、本番環境に実装する前に、同じ内容のサイトが先にインデックス化されてしまう事になります。<br />
ちょっと考えると非常にまずいことがわかると思います。<br />
<br />
<br />
### 対策
対策としては、以下のように検索BOTへの対応を行う必要があります。<br />
<br />
1.メタタグへの記述で対話<br />
一般的な検索BOTは、ページ内ソースの記述を解析している途中で<br />
<br />
<meta name="robots" content="noindex,follow" /><br />
<br />
とメタタグ内に記述してあると、「このページは検索結果に反映させたくない」というこちらの意図を汲んでくれます。<br />
話せば分かる、という感じで個人的にはこの方法が一番スマートだと思います。<br />
が、以下のような問題もあります。<br />
<br />
・一部の行儀の悪いBOTはこの記述を無視する可能性がある（今もあるかどうかわかりませんがbaiduなど過去にはありました）<br />
・本番反映した時に、この記述を外しておかないと、本番ドメインが一向にインデックスされない<br />
<br />
前者はともかく、後者はクライアントによっては致命的な事態を引き起こしかねないため、注意が必要です。<br />
<br />
<br />
2.クローラーのユーザーエージェント（またはIP）を判別して別のページを表示させる<br />
先述のUAをサーバ側で検知し、それらに対してリダイレクト（404や403を返しても構いませんが）させる方法です。<br />
<br />
これは1.と同様に開発者、あるいはクライアントが本番と同じ形でサイトを閲覧可能になるので便利に思えますが、UAのリスト管理が面倒なのと定期的な保守が必要になります。<br />
<br />
3.開発者とクライアントのIPのみ閲覧許可する<br />
2とは逆に、一旦全て排除した上で特定のIPからのみ閲覧を許可する方法です。<br />
IPが変更になった場合、追加が必要なのと、課金やプロモーションなどで外部APIとのつなぎ込みがあるサイトの場合、それらも全て許可しないといけないところが注意点です。<br />
<br />
4.basic認証<br />
サイト自体にIDPWを用意して、閲覧の度に入力してもらうようにするパターンです。<br />
非常に煩わしいのですが、セキュリティ上これでないといけないクライアントもいます。<br />
3と同じく、サイト全域でbasic認証をかけた場合、APIとの繋ぎ込みなどで思わぬエラーが出たりしますので、決済関連のソースのみは閲覧許可するなどの設定は必要です。<br />
<br />
<br />
### 総括
結局3と4に関しては、万が一の関係者以外からのアクセスを遮断する効果もありますので、BOT対策を含めてどちらかの設定をするように務めたほうがベストかも知れません。<br />
<br />
少なくとも、これらのどれかの対応は必ず開発環境（検証環境も含む）で導入するようにしておきましょう。<br />

